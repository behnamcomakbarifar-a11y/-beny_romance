import 'package:url_launcher/url_launcher.dart';
import 'package:flutter/material.dart';
import '../models/film.dart';

class FilmDetailScreen extends StatelessWidget {
  final Film film;

    const FilmDetailScreen({super.key, required this.film});

      // تابع برای باز کردن لینک در مرورگر
        Future<void> _launchWatchUrl(BuildContext context) async {
            final String url = film.watchUrl; // فرض بر این است که در مدل Film فیلد watchUrl دارید
                
                    if (url.isEmpty) {
                          ScaffoldMessenger.of(context).showSnackBar(
                                  const SnackBar(content: Text('لینک تماشا برای این فیلم ثبت نشده است')),
                                        );
                                              return;
                                                  }

                                                      final Uri uri = Uri.parse(url);
                                                          try {
                                                                if (await canal_launchUrl(uri)) {
                                                                         await launchUrl(uri, mode: LaunchMode.externalApplication);
                                                                               } else {
                                                                                       throw 'Could not launch $url';
                                                                                             }
                                                                                                 } catch (e) {
                                                                                                       ScaffoldMessenger.of(context).showSnackBar(
                                                                                                               SnackBar(content: Text('خطا در باز کردن لینک: $e')),
                                                                                                                     );
                                                                                                                         }
                                                                                                                           }

                                                                                                                             // متد کمکی برای استفاده از تابع بالا (رفع خطای احتمالی لایبرری)
                                                                                                                               Future<bool> canal_launchUrl(Uri url) async {
                                                                                                                                   return await canLaunchUrl(url);
                                                                                                                                     }

                                                                                                                                       @override
                                                                                                                                         Widget build(BuildContext context) {
                                                                                                                                             return Scaffold(
                                                                                                                                                   appBar: AppBar(
                                                                                                                                                           title: Text(film.title),
                                                                                                                                                                 ),
                                                                                                                                                                       body: SingleChildScrollView(
                                                                                                                                                                               padding: const EdgeInsets.all(16),
                                                                                                                                                                                       child: Column(
                                                                                                                                                                                                 crossAxisAlignment: CrossAxisAlignment.start,
                                                                                                                                                                                                           children: [
                                                                                                                                                                                                                       // Poster
                                                                                                                                                                                                                                   Center(
                                                                                                                                                                                                                                                 child: film.imageUrl.startsWith('http')
                                                                                                                                                                                                                                                                   ? Image.network(
                                                                                                                                                                                                                                                                                         film.imageUrl,
                                                                                                                                                                                                                                                                                                               height: 300,
                                                                                                                                                                                                                                                                                                                                     fit: BoxFit.cover,
                                                                                                                                                                                                                                                                                                                                                         )
                                                                                                                                                                                                                                                                                                                                                                           : const Icon(Icons.movie, size: 100),
                                                                                                                                                                                                                                                                                                                                                                                       ),

                                                                                                                                                                                                                                                                                                                                                                                                   const SizedBox(height: 24),

                                                                                                                                                                                                                                                                                                                                                                                                               // Title
                                                                                                                                                                                                                                                                                                                                                                                                                           Text(
                                                                                                                                                                                                                                                                                                                                                                                                                                         film.title,
                                                                                                                                                                                                                                                                                                                                                                                                                                                       style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           fontWeight: FontWeight.bold,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               color: Colors.white,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ),

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         const SizedBox(height: 12),

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     // Description
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Text(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               film.description,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 color: Colors.grey[300],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     height: 1.5,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ),

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               const SizedBox(height: 24),

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           // Subtitle status
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Row(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     children: [
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Icon(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       film.hasSubtitle ? Icons.subtitles : Icons.subtitles_off,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         color: film.hasSubtitle ? Colors.green : Colors.grey,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         const SizedBox(width: 8),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Text(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           film.hasSubtitle
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ? 'زیرنویس آماده است'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       : film.aiSubtitleSupported
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ? 'زیرنویس با AI قابل تولید است'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           : 'زیرنویس ندارد',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             style: TextStyle(color: Colors.grey[400]),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           ],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ),

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   const SizedBox(height: 32),

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               // Watch button
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           Center(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         child: ElevatedButton.icon(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         onPressed: () => _launchWatchUrl(context),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         icon: const Icon(Icons.play_circle_fill),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         label: const Text(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           'تماشا',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             style: ElevatedButton.styleFrom(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               backgroundColor: Colors.deepPurple,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 foregroundColor: Colors.white,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   padding: const EdgeInsets.symmetric(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       horizontal: 40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           vertical: 15,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               shape: RoundedRectangleBorder(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   borderRadius: BorderRadius.circular(30),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             